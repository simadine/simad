@{
    ViewBag.Title = "Directorio de empresas";
    ViewBag.Description = "Directorio de empresas";
    Layout = "~/Views/Shared/_Default.cshtml";
}



<div class="row">
  
    <div class="col-xs-12 col-md-12">
        <div class="widget">
            <div class="widget-header ">
                <span class="widget-caption">Listado de empresas</span>
                <div class="widget-buttons">
                    <a href="#" data-toggle="maximize">
                        <i class="fa fa-expand"></i>
                    </a>
                    <a href="#" data-toggle="collapse">
                        <i class="fa fa-minus"></i>
                    </a>
                    <a href="#" data-toggle="dispose">
                        <i class="fa fa-times"></i>
                    </a>
                </div>
                
            </div>
            <div class="widget-body">
                <div class="table-toolbar">
                    <a   data-toggle="modal" data-target="#ModalNuevaEmpresa" class="btn btn-default">
                        Nueva empresa
                    </a>

                    @*@using (Html.BeginForm("ImportarEmpresas", "Directorio", FormMethod.Post, new {enctype = "multipart/form-data" })) {
                        Html.Raw(ViewBag.error);
                      <input type="file"  name="ExcelFile" class="btn btn-default">
                        <input type="submit" value="Importar" class="btn btn-default">
                    }*@
                </div>
                <table class="table table-striped table-bordered table-hover" id="ListaDeEmpresas">
                    
                    <thead>
                        <tr>
                            <th>Rut</th>
                            <th>Razón social</th>
                            <th>Comuna</th>
                            <th>Representate legal</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>




<!--Modal listado establecimientos por empresa-->
@using (var modal = Html.Bootstrap().Begin(new Modal().Id("largeModal").Closeable().Size(BootstrapSizes.Large)))
{
    using (var header = modal.BeginHeader())
    {
        <h4 class="modal-title" id="myLargeModalLabel">Establecimientos de   ABAD GARCIA Y PONS LTDA. </h4>
    }
    using (var body = modal.BeginBody())
    {
        <div class="row">
            <div class="col-xs-12 col-md-12">
                <div class="widget">

                    <div class="widget-body">

                        <table class="table table-striped table-hover table-bordered" id="editabledatatable">
                            <thead>
                                <tr role="row">
                                    <th>
                                        ROL
                                    </th>
                                    <th>
                                        RUT
                                    </th>
                                    <th>
                                        Razon Social
                                    </th>
                                    <th>
                                        Establecimiento
                                    </th>
                                    <th>
                                        Comuna
                                    </th>
                                </tr>
                            </thead>

                            <tbody>
                                <tr>
                                    <td><a href="#">15090</a></td>
                                    <td>81624000</td>
                                    <td>ABAD GARCIA Y PONS LTDA.</td>
                                    <td>IVCM CASA GARCIA</td>
                                    <td>Los Angeles</td>
                                </tr>
                                <tr>
                                    <td>
                                        <a href="#">81624000</a>
                                    </td>
                                    <td>
                                        81624000
                                    </td>
                                    <td>
                                        ABAD GARCIA Y PONS LTDA.
                                    </td>
                                    <td></td>
                                    <td>
                                        Los Angeles
                                    </td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    }
}

<!--Modal listado estableciemientos por empresa-->

<!--Modal nuevo establecimiento-->
@using (var modal = Html.Bootstrap().Begin(new Modal().Id("ModalNuevoEstablecimiento").Closeable().Size(BootstrapSizes.XXXLarge)))
{
    using (var header = modal.BeginHeader())
    {
        <h4 class="modal-title" id="myLargeModalLabel">Nuevo establecimiento para  ABAD GARCIA Y PONS LTDA. </h4>
    }
    using (var body = modal.BeginBody())
    {
        <div class="row">
            <div class="col-xs-12">
                <div class="widget-body">
                    <div id="registration-form">
                        <form role="form">
                            <div class="form-title">
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label> Empresa</label>
                                        <input type="text" class="form-control">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label> Nombre</label>
                                        <input type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label> Rut</label>
                                        <input type="text" class="form-control" id="passwordInput" placeholder="">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label> Rol</label>
                                        <input type="text" class="form-control" id="passwordInput" placeholder="">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label> Estado</label>
                                        <select class="form-control">
                                            <option value="0" selected></option>
                                            <option>Activa</option>
                                            <option>Cerrada</option>
                                            <option>Inubicable Temporalmente</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-title">
                                Ubicación
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label> Dirección</label>
                                        <input type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Resto dirección</label>
                                        <input type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Número</label>
                                        <input type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label> Tipo de via</label>
                                        <select class="form-control">
                                            <option value="0" selected></option>
                                            <option>Calle </option>
                                            <option>Camino </option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label> Comuna</label>
                                        <select class="form-control">
                                            <option value="0" selected></option>
                                            <option>Comuna </option>
                                            <option>Comuna 2</option>
                                        </select>
                                    </div>
                                </div>

                            </div>

                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Telefono 1</label>
                                        <input type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Telefono 2</label>
                                        <input type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Telefono 3</label>
                                        <input type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Correo electronico</label>
                                        <input type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Sitio web</label>
                                        <input type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Casilla</label>
                                        <input type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                            </div>
                            <div class="form-title">
                                Actividad económica
                            </div>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label> Sección</label>
                                        <select class="form-control">
                                            <option value="0" selected></option>
                                            <option> </option>
                                            <option>Camino </option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label> División</label>
                                        <select class="form-control">
                                            <option value="0" selected></option>
                                            <option> </option>
                                            <option>Camino </option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label> Grupo</label>
                                        <select class="form-control">
                                            <option value="0" selected></option>
                                            <option>Comuna </option>
                                            <option>Comuna 2</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label> Clase</label>
                                        <select class="form-control">
                                            <option value="0" selected></option>
                                            <option>Comuna </option>
                                            <option>Comuna 2</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-title">
                                Datos de informante
                            </div>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Nombre informante</label>
                                        <input type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Telefono informante </label>
                                        <input type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Correo informante</label>
                                        <input type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Cargo informante</label>
                                        <input type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label>Observacion</label>
                                        <textarea class="form-control"></textarea>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-blue">Almacenar</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    }
}

<!--Fin Modal  nuevo estableciemiento-->


<!--Modal nueva Empresa-->
@using (var modal = Html.Bootstrap().Begin(new Modal().Id("ModalNuevaEmpresa").Closeable().Size(BootstrapSizes.Normal)))
{
    using (var header = modal.BeginHeader())
    {
        <h4 class="modal-title" id="myLargeModalLabel">Nueva empresa </h4>
    }
    using (var body = modal.BeginBody())
    {
        <div class="row">
            <div class="col-xs-12">
                <div class="widget-body">
                  @Html.Action("ParcialNuevaEmpresa","Directorio")
                </div>
            </div>
        </div>
    }
}

<!--Fin Modal nueva Empresa-->

@section PageScripts{
   
    <link href="~/assets/css/dataTables.bootstrap.css" rel="stylesheet" />
    <script src="~/assets/js/datatable/jquery.dataTables.min.js"></script>
    <script src="~/assets/js/datatable/ZeroClipboard.js"></script>
    <script src="~/assets/js/datatable/dataTables.tableTools.min.js"></script>
    <script src="~/assets/js/datatable/dataTables.bootstrap.min.js"></script>
    <script src="~/assets/js/datatable/datatables-init.js"></script>
    <script src="~/assets/js/toastr/toastr.js"></script>
    <script src="~/assets/js/jqueryval/jquery.validate.js"></script>
    <script src="~/assets/js/rut/jquery.Rut.js"></script>
    <script src="~/assets/js/bootbox/bootbox.js"></script>
    <script>
        InitiateListaDeEmpresas.init();
        InitiateListaDeEstablecimientos.init();

        function EmpresaExiste(Input) {
            var RutEmpresa = $(Input).val();
            $.ajax({
                type: 'POST',
                url: '/Widget/EmpresaExiste?RutEmpresa='+RutEmpresa,
                DataType: 'json',
                success: function (data) {
                    if (data == true) {
                        $("#DvEmpresa").val('');
                        $("#rut").focus();
                        Notify('El rut ingresado ya existe', 'bottom-right', '5000', 'warning', 'fa-check', true);
                    } 
                }
            });
        }

        $(document).ready(function () {
            $(".select-provincia").change(function () {
               var CodProvincia= $(".select-provincia option:selected").val();
                $.ajax({
                    type: 'POST',
                    url: '/Widget/ParcialComunas?CodProvincia=' + CodProvincia,
                    DataType: 'json',
                    success: function (data) {
                        $("#comunas").html(data);
                    }
                 });
            });
            $("#rut").Rut({
                digito_verificador: "#DvEmpresa",
                format: false,
                on_error: function () {
                    $("#rut").focus();
                    Notify('El rut ingresado no es valido', 'bottom-right', '5000', 'warning', 'fa-check', true);
                }
            });


            $("#NuevaEmpresa").validate({
                errorPlacement: function () { return false; },
                highlight: function (element) {
                    $(element).closest('.form-group').addClass('has-error');
                },
                unhighlight: function (element) {
                    $(element).closest('.form-group').removeClass('has-error');
                },
                submitHandler: function (form) {
                    var formulario = $('#NuevaEmpresa').serialize();
                    $.ajax({
                        type: 'POST',
                        url: '/Directorio/NuevaEmpresa/',
                        data: formulario,
                        DataType: 'json',
                        success: function (data) {
                            if (data == 1) {
                                Notify('Empresa creada con exito.', 'bottom-right', '5000', 'success', 'fa-check', true);
                            }else {
                                Notify('La empresa ya fue ingresada', 'bottom-right', '5000', 'warning', 'fa-check', true);
                            }
                        }
                    });
                }
            });
        });
    </script>
}